<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Framework: 2030 Agenda for Sustainable Development</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        :root {
            --primary: #000000; 
            --accent: #2563eb; /* Clear, bright academic blue */
            --habit-accent: #d97706; /* Clear amber */
            --bg-page: #f8fafc;
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-page); 
            color: var(--primary); 
            margin: 0; 
            overflow: hidden; 
            line-height: 1.6;
        }

        /* High-Contrast Navigation Tree */
        .tree-container { padding: 60px 40px; overflow-x: auto; }
        .tree ul { padding-top: 30px; position: relative; display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; max-width: 1600px; margin: 0 auto; }
        .tree li { list-style-type: none; position: relative; }
        
        .node { 
            border: 3px solid var(--primary); padding: 18px 24px; text-decoration: none; 
            color: var(--primary); font-size: 0.9rem; font-weight: 800; 
            display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s; 
            cursor: pointer; background: var(--card-bg); box-shadow: 6px 6px 0px var(--primary);
            min-width: 280px; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;
        }
        .node:hover { background: var(--primary); color: var(--card-bg); transform: translate(-3px, -3px); box-shadow: 9px 9px 0px var(--accent); }

        /* Unified Clear Modal */
        .modal { display: none; position: fixed; z-index: 1000; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); overflow-y: auto; }
        .modal-content { background: var(--card-bg); margin: 0 auto; min-height: 100vh; width: 100%; max-width: 1400px; animation: fadeIn 0.3s ease; box-shadow: 0 0 50px rgba(0,0,0,0.5); border-left: 4px solid var(--primary); border-right: 4px solid var(--primary); }
        
        /* Interactive TTS Blocks */
        .speakable { cursor: pointer; transition: all 0.2s; padding: 30px; border: 2px solid transparent; position: relative; border-radius: 8px; }
        .speakable:hover { background: #f1f5f9; border-color: var(--primary); }
        .speakable::after { content: 'ðŸ”Š CLICK TO LISTEN (85% SPEED)'; position: absolute; top: 12px; right: 15px; font-size: 0.65rem; font-weight: 900; color: var(--accent); opacity: 0; transition: opacity 0.2s; letter-spacing: 0.05em; }
        .speakable:hover::after { opacity: 1; }

        /* Stakeholder Columns */
        .stakeholder-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; border-top: 4px solid var(--primary); border-bottom: 4px solid var(--primary); background: #f8fafc; }
        .stakeholder-card { border-right: 4px solid var(--primary); padding: 40px; background: var(--card-bg); display: flex; flex-direction: column; gap: 20px; }
        .stakeholder-card:last-child { border-right: none; }
        
        .scaffold-box { background: #eff6ff; border: 2px solid var(--accent); padding: 20px; border-radius: 4px; }
        .evidence-tag { font-size: 0.7rem; font-weight: 800; background: var(--primary); color: #fff; padding: 4px 8px; text-transform: uppercase; border-radius: 2px; display: inline-block; margin-top: 5px; }

        /* Left-Justified GRASPS */
        .grasps-container { padding: 40px; background: #ffffff; }
        .grasps-item { display: flex; gap: 30px; padding: 25px 0; border-bottom: 2px solid #e2e8f0; align-items: flex-start; text-align: left; }
        .grasps-item:last-child { border-bottom: none; }
        .grasps-label { font-weight: 900; color: var(--accent); font-size: 2.5rem; width: 50px; text-align: left; line-height: 1; }
        .grasps-desc { font-weight: 900; font-size: 0.9rem; color: var(--primary); width: 140px; text-transform: uppercase; padding-top: 10px; letter-spacing: 0.1em; }
        .grasps-val { flex: 1; font-size: 1.15rem; font-weight: 600; color: var(--primary); padding-top: 5px; }

        .section-header { background: var(--primary); color: white; padding: 20px 40px; font-weight: 900; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.25em; }

        #activity-console { background: var(--primary); color: #ffffff; padding: 40px; font-family: 'Courier New', monospace; font-size: 1rem; border-left: 12px solid var(--accent); border-radius: 4px; margin: 40px 0; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Main Workspace Header -->
    <header class="bg-white border-b-[4px] border-black px-12 py-4 flex flex-col items-center text-center shrink-0 z-10">
        <h1 class="text-2xl font-black tracking-tight text-black uppercase">The 17 UN Sustainable Development Goals</h1>
    </header>

    <!-- Scrollable Goal Grid -->
    <div class="flex-1 overflow-auto bg-slate-50">
        <div class="tree-container">
            <div class="tree" id="treeRoot"></div>
        </div>
    </div>

    <!-- Detailed Single-Page Insight Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="bg-black text-white p-6 flex justify-between items-center border-b-[8px] border-blue-600 sticky top-0 z-50">
                <div class="max-w-4xl">
                    <p class="text-[8px] font-black uppercase tracking-[0.4em] text-blue-400 mb-1">Academic Seminar Module</p>
                    <h2 id="modalTitle" class="text-lg font-black uppercase tracking-tight leading-tight"></h2>
                </div>
                <button onclick="closeModal()" class="text-white hover:text-blue-400 text-4xl font-light leading-none px-4">&times;</button>
            </div>
            
            <div class="modal-body bg-white">
                
                <!-- Inquiry Section -->
                <div class="p-12 border-b-4 border-black speakable" onclick="speakText(this)">
                    <p class="font-black text-sm uppercase tracking-widest text-black border-b-4 border-black inline-block pb-2 mb-6">Essential Inquiry Question</p>
                    <p id="eqDisplay" class="text-4xl font-black text-black leading-snug italic"></p>
                    
                    <div class="mt-10 p-6 bg-slate-100 border-l-8 border-amber-600">
                        <p class="text-xs font-black uppercase tracking-widest text-amber-700 mb-2">Metacognitive Objective</p>
                        <p class="text-lg font-bold text-black leading-relaxed">Understand that disagreement often stems from different cognitive approaches, not just different opinions. Develop intellectual empathy by practicing tools outside your natural preference.</p>
                    </div>
                </div>

                <!-- Stakeholder Perspectives -->
                <div class="section-header">Stakeholder Mapping: Educational, Environmental, and Economic Perspectives</div>
                <div class="stakeholder-grid" id="stakeholder-container"></div>

                <!-- GRASPS Table -->
                <div class="grasps-container speakable" onclick="speakText(this)">
                    <p class="font-black text-sm uppercase tracking-widest text-black border-b-4 border-black inline-block pb-2 mb-8">Performance Assessment: GRASPS</p>
                    <div class="grasps-row">
                        <div class="grasps-item">
                            <div class="grasps-label">G</div>
                            <div class="grasps-desc">Goal</div>
                            <div id="grasps-g" class="grasps-val"></div>
                        </div>
                        <div class="grasps-item">
                            <div class="grasps-label">R</div>
                            <div class="grasps-desc">Role</div>
                            <div id="grasps-r" class="grasps-val font-black"></div>
                        </div>
                        <div class="grasps-item">
                            <div class="grasps-label">A</div>
                            <div class="grasps-desc">Audience</div>
                            <div id="grasps-a" class="grasps-val"></div>
                        </div>
                        <div class="grasps-item">
                            <div class="grasps-label">S</div>
                            <div class="grasps-desc">Situation</div>
                            <div id="grasps-s" class="grasps-val italic"></div>
                        </div>
                        <div class="grasps-item">
                            <div class="grasps-label">P</div>
                            <div class="grasps-desc">Product</div>
                            <div id="grasps-p" class="grasps-val font-black underline decoration-blue-600 decoration-4 underline-offset-4"></div>
                        </div>
                        <div class="grasps-item">
                            <div class="grasps-label">S</div>
                            <div class="grasps-desc">Standards</div>
                            <div class="grasps-val">KASEC Academic Rubric (Knowledge, Analysis, Structure, Evidence, Clarity)</div>
                        </div>
                    </div>
                </div>

                <!-- Debate Dynamics Console -->
                <div class="p-12 bg-slate-100 border-t-8 border-black">
                    <p class="font-black text-sm uppercase tracking-widest text-black border-b-4 border-black inline-block pb-2 mb-8">Debate Preparation: Cognitive Sprint</p>
                    <p class="text-lg font-bold mb-6">Explicitly teach the cognitive tool and habit alongside SDG content. Model the behavior below to craft more nuanced arguments that anticipate opposition.</p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 mb-10">
                        <div class="p-8 bg-white border-4 border-black">
                            <h4 class="text-xs font-black uppercase mb-4 text-blue-600 tracking-widest">Cognitive Strategy Activity</h4>
                            <p class="text-lg font-bold leading-relaxed italic" id="tool-prompt-text"></p>
                        </div>
                        <div class="p-8 bg-white border-4 border-black">
                            <h4 class="text-xs font-black uppercase mb-4 text-amber-600 tracking-widest">Behavioral Habit Modeling</h4>
                            <p class="text-lg font-bold leading-relaxed italic" id="habit-prompt-text"></p>
                        </div>
                    </div>
                    
                    <div id="activity-console" class="shadow-xl">
                        <button onclick="startActivity()" class="w-full bg-white text-black py-6 font-black uppercase text-sm tracking-[0.2em] hover:bg-blue-600 hover:text-white transition-all border-4 border-white mb-8">Initiate Metacognitive Sprint</button>
                        <div id="console-output" class="space-y-6"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Complete 17 SDG Data Mapping based on User CSV and TXT inputs
        const curriculumData = [
            { id: 1, name: "1: No Poverty", eq: "Should wealth redistribution be mandatory?",
              grasps: { g: "Design a systemic redistribution model.", r: "Economic Advisor", a: "Policy Committee", s: "Poverty is rising despite GDP growth.", p: "Policy Proposal & Impact Model" },
              stakeholders: [
                { role: "Educational", tool: "Perspective-Taking", habit: "Listening with Empathy", for: "Center marginalized voices in economic planning.", against: "Consider implementation challenges of massive redistribution.", scaffold: "While recognizing the systemic need for..., we must consider...", evidence: "Sociological case studies", prompt: "Write one sentence from the viewpoint of someone directly affected by educational fee hikes." },
                { role: "Environmental", tool: "Systems Mapping", habit: "Thinking Interdependently", for: "Map poverty's root causes to resource scarcity.", against: "Ensure ecological sustainability of relief solutions.", scaffold: "There is a direct correlation between resource access and...", evidence: "GIS mapping data", prompt: "Draw three distinct connections between soil health and the local unemployment rate." },
                { role: "Economic", tool: "Futures Thinking", habit: "Applying Past Knowledge", for: "Invest heavily in human capital for future returns.", against: "Avoid disincentivizing workforce productivity.", scaffold: "Based on historical economic patterns, a mandatory shift...", evidence: "Longitudinal GDP data", prompt: "Cite one specific data point where a tax framework failed to stimulate long-term growth." }
              ]},
            { id: 2, name: "2: Zero Hunger", eq: "Should GMO crops be widely adopted?",
              grasps: { g: "Resolve a regional food security crisis.", r: "Food Strategist", a: "Health Organization", s: "Traditional supply chains are failing nutritional needs.", p: "Tech vs. Traditional Strategy Report" },
              stakeholders: [
                { role: "Educational", tool: "Perspective-Taking", habit: "Managing Impulsivity", for: "Address immediate food needs urgently.", against: "Consider long-term educational impacts on farming knowledge.", scaffold: "Though the immediate yield is attractive, the long-term cost to...", evidence: "Agronomy education reports", prompt: "Create a visual model showing how gene-splicing results in increased crop durability." },
                { role: "Environmental", tool: "Pattern Recognition", habit: "Gathering Data Through Senses", for: "Increase yield sustainably on existing land.", against: "Monitor severe biodiversity impacts.", scaffold: "The recurring pattern in this environmental data indicates...", evidence: "Biodiversity trackers", prompt: "Identify the pattern of bird migration in fields using non-modified versus modified seeds." },
                { role: "Economic", tool: "Modeling", habit: "Creating, Imagining", for: "Scale efficient global food production.", against: "Protect local smallholder livelihoods from monopolies.", scaffold: "If we model this patent structure globally, the result for...", evidence: "Patent monopoly archives", prompt: "Explain how seed patents are analogous to mobile app store developer fees." }
              ]},
            { id: 3, name: "3: Good Health and Well-being", eq: "Should healthcare be fully privatized to increase quality?", tool: "Ethical Reasoning", habit: "Gathering Data", grasps: { g: "Design a universal health pilot.", r: "Policy Analyst", a: "Ministry of Health", s: "Disparity between urban and rural life expectancy.", p: "National Health Equity Plan" }, stakeholders: [] },
            { id: 4, name: "4: Quality Education", eq: "Should higher education be free for all citizens?", tool: "Metacognition", habit: "Remaining Open to Learning", grasps: { g: "Assess economic ROI of free degrees.", r: "Academic Dean", a: "State Budget Office", s: "Student debt is crippling the workforce.", p: "Education Funding Manifesto" }, stakeholders: [] },
            { id: 5, name: "5: Gender Equality", eq: "Should gender quotas be mandatory in corporate boards?", tool: "Perspective-Taking", habit: "Thinking Flexibly", grasps: { g: "Redesign executive recruitment.", r: "DEI Consultant", a: "Fortune 500 Board", s: "Only 10% of senior leadership is female.", p: "Corporate Equity Audit" }, stakeholders: [] },
            { id: 6, name: "6: Clean Water and Sanitation", eq: "Should water be treated as a commodity or a human right?", tool: "Dimensional Thinking", habit: "Managing Impulsivity", grasps: { g: "Manage a severe drought crisis.", r: "Water Commissioner", a: "Industrial and Public Stakeholders", s: "Water levels at record lows.", p: "Emergency Allocation & Pricing Policy" }, stakeholders: [] },
            { id: 7, name: "7: Affordable and Clean Energy", eq: "Should nuclear energy be categorized as 'green'?", tool: "Analogizing", habit: "Striving for Accuracy", grasps: { g: "Select a national energy mix.", r: "Grid Architect", a: "Environmental Agency", s: "Renewables are intermittent and coal is fading.", p: "2050 Energy Decarbonization Roadmap" }, stakeholders: [] },
            { id: 8, name: "8: Decent Work and Economic Growth", eq: "Should a Universal Basic Income be implemented due to AI?", tool: "Futures Thinking", habit: "Creating, Imagining, Innovating", grasps: { g: "Mitigate mass automation job loss.", r: "Labor Union Lead", a: "Economic Council", s: "Manufacturing automation is replacing 40% of labor.", p: "Post-Work Economic Stability Plan" }, stakeholders: [] },
            { id: 9, name: "9: Industry, Innovation and Infrastructure", eq: "Should space exploration take priority over Earth's bridges?", tool: "Visualizing", habit: "Taking Responsible Risks", grasps: { g: "Justify a 50B space budget.", r: "Aerospace Director", a: "Taxpayers", s: "Infrastructure is failing but Mars is reachable.", p: "Strategic Frontier Priority Report" }, stakeholders: [] },
            { id: 10, name: "10: Reduced Inequalities", eq: "Should schools prioritize global citizenship over heritage?", tool: "Perspective-Taking", habit: "Thinking Flexibly", grasps: { g: "Design a dual-identity curriculum.", r: "Curriculum Specialist", a: "National School Board", s: "Globalization is erasing local dialects.", p: "Heritage vs. Global Integrated Syllabus" }, stakeholders: [] },
            { id: 11, name: "11: Sustainable Cities and Communities", eq: "Should cars be banned from all city centers?", tool: "Systems Mapping", habit: "Thinking Interdependently", grasps: { g: "Transform a traffic-heavy district.", r: "Urban Planner", a: "Retailers and Residents", s: "Air quality is 4x dangerous limits.", p: "Pedestrian District Transition Model" }, stakeholders: [] },
            { id: 12, name: "12: Responsible Consumption and Production", eq: "Should planned obsolescence be illegal?", tool: "Pattern Recognition", habit: "Questioning & Problem Posing", grasps: { g: "Regulate the electronics industry.", r: "Consumer Advocate", a: "Tech Giants & Gov", s: "E-waste is the fastest growing waste stream.", p: "Right-to-Repair Legislation Proposal" }, stakeholders: [] },
            { id: 13, name: "13: Climate Action", eq: "Should a global carbon tax be mandatory?", tool: "Futures Thinking", habit: "Taking Responsible Risks", grasps: { g: "Negotiate a tri-nation carbon deal.", r: "Climate Envoy", a: "G20 Leaders", s: "CO2 levels at tipping point.", p: "Universal Carbon Pricing Accord" }, stakeholders: [] },
            { id: 14, name: "14: Life Below Water", eq: "Should deep-sea mining be permitted for green tech?", tool: "Visualizing", habit: "Responding with Wonderment", grasps: { g: "Permit or ban a mining site.", r: "Maritime Authority", a: "Mining Corp & Biologists", s: "Sea floor has cobalt but unknown biodiversity.", p: "Deep Sea Extraction Impact Study" }, stakeholders: [] },
            { id: 15, name: "15: Life on Land", eq: "Should rewilding take precedence over agriculture?", tool: "Systems Mapping", habit: "Thinking Interdependently", grasps: { g: "Allocate a 500-mile wildlife corridor.", r: "Land Use Director", a: "Farmers and Ecologists", s: "Species migration is blocked by soy farms.", p: "National Rewilding & Food Security Map" }, stakeholders: [] },
            { id: 16, name: "16: Peace, Justice and Strong Institutions", eq: "Should social media be regulated for misinformation?", tool: "Ethical Reasoning", habit: "Thinking with Clarity", grasps: { g: "Draft a Truth in Media act.", r: "High Court Judge", a: "Platforms & Human Rights Groups", s: "Fake news is triggering unrest.", p: "Content Regulation Framework" }, stakeholders: [] },
            { id: 17, name: "17: Partnerships for the Goals", eq: "Should developed nations fund global climate adaptation?", tool: "Collaborative Sense-making", habit: "Thinking Interdependently", grasps: { g: "Broker a $100B North-South fund.", r: "International Mediator", a: "Global Finance Ministers", s: "Islands are sinking while industry thrives.", p: "Global Equity Finance Treaty" }, stakeholders: [] }
        ];

        // Ensure stakeholder structure for all goals if missing
        curriculumData.forEach(item => {
            if (item.stakeholders.length === 0) {
                item.stakeholders = [
                    { role: "Educational", for: "Develop critical global literacy through subject-integrated modules.", against: "Risk of curriculum overload if too many global themes are added.", prompt: "Synthesize the view of an educator in a low-resource classroom.", scaffold: "By synthesizing these views, we find that...", evidence: "Educational research" },
                    { role: "Environmental", for: "Protect long-term ecological balance through strict enforcement.", against: "Economic slow-down could reduce funding for green innovation.", prompt: "Map the connection between this goal and local biodiversity.", scaffold: "When we visualize the outcome of...", evidence: "Ecology reports" },
                    { role: "Economic", for: "Market competition can drive the most efficient solutions to this goal.", against: "Externalities and social costs are often ignored by profit-seeking firms.", prompt: "Predict the state of this industry in 2045.", scaffold: "Looking at this through a 50-year dimension...", evidence: "Market analysis" }
                ];
            }
        });

        let activeItem = curriculumData[0];

        function renderTree() {
            const root = document.getElementById('treeRoot');
            let html = '<ul>';
            curriculumData.forEach(item => {
                html += `<li><div class="node" onclick="openModal(${item.id})">${item.name}</div></li>`;
            });
            html += '</ul>';
            root.innerHTML = html;
        }

        function openModal(id) {
            activeItem = curriculumData.find(i => i.id === id);
            
            document.getElementById('modalTitle').innerText = activeItem.name;
            document.getElementById('eqDisplay').innerText = `"${activeItem.eq}"`;

            // Identify Active Tool and Habit with fallback to the item level defaults
            const activeTool = activeItem.stakeholders[0].tool || activeItem.tool || "Cognitive Tool";
            const activeHabit = activeItem.stakeholders[0].habit || activeItem.habit || "Habit of Mind";

            // Stakeholders
            const container = document.getElementById('stakeholder-container');
            container.innerHTML = activeItem.stakeholders.map(s => `
                <div class="stakeholder-card speakable" onclick="speakText(this)">
                    <div>
                        <p class="text-[11px] font-black uppercase text-blue-600 mb-2 tracking-[0.2em] border-b-2 border-blue-600 inline-block">${s.role} Perspective</p>
                        <p class="text-xl font-black text-black uppercase leading-tight mt-4">${s.tool || activeItem.tool || 'Cognitive Tool'}</p>
                        <p class="text-sm font-bold text-amber-600 uppercase mt-1 tracking-widest">${s.habit || activeItem.habit || 'Habit of Mind'}</p>
                    </div>
                    
                    <div class="mt-6 space-y-6">
                        <div>
                            <p class="text-[10px] font-black uppercase text-black mb-2 tracking-widest">FOR Argument</p>
                            <p class="text-base font-bold text-black italic leading-relaxed border-l-4 border-blue-600 pl-4">${s.for}</p>
                        </div>
                        <div>
                            <p class="text-[10px] font-black uppercase text-black mb-2 tracking-widest">AGAINST Argument</p>
                            <p class="text-sm font-medium text-black leading-relaxed border-l-4 border-amber-600 pl-4">${s.against}</p>
                        </div>
                    </div>

                    <div class="scaffold-box">
                        <p class="text-[10px] font-black uppercase text-black mb-2 tracking-widest">Language Scaffold (B2/C1)</p>
                        <p class="text-sm text-black italic font-semibold leading-relaxed">"${s.scaffold}"</p>
                        <p class="evidence-tag mt-3">Evidence: ${s.evidence}</p>
                    </div>
                </div>
            `).join('');

            // Prompts
            document.getElementById('tool-prompt-text').innerText = `"${activeTool}: ${activeItem.stakeholders[0].prompt}"`;
            document.getElementById('habit-prompt-text').innerText = `"${activeHabit}: List one valid empirical data point from the opposing view to build intellectual empathy."`;

            // GRASPS
            document.getElementById('grasps-g').innerText = activeItem.grasps.g;
            document.getElementById('grasps-r').innerText = activeItem.grasps.r;
            document.getElementById('grasps-a').innerText = activeItem.grasps.a;
            document.getElementById('grasps-s').innerText = activeItem.grasps.s;
            document.getElementById('grasps-p').innerText = activeItem.grasps.p;

            document.getElementById('detailModal').style.display = "block";
            document.body.style.overflow = "hidden";
            
            speakByVoice(`Initializing academic framework for ${activeItem.name}. Analyze the structural tensions between stakeholders.`, 'Andrew');
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = "none";
            document.body.style.overflow = "auto";
            window.speechSynthesis.cancel();
        }

        function startActivity() {
            const output = document.getElementById('console-output');
            output.innerHTML = `<p class="text-blue-400 font-black tracking-widest uppercase text-sm">> BOOTING COGNITIVE SPRINT...</p>`;
            
            const activeTool = activeItem.stakeholders[0].tool || activeItem.tool || "Cognitive Tool";
            setTimeout(() => {
                const prompt = `WORKSHOP CHALLENGE: 1. Acknowledge the opposition. 2. Analyze the evidence. 3. Bridge the gap using ${activeTool}. Respond to: "${activeItem.eq}"`;
                output.innerHTML += `<p class="mt-8 text-white font-bold leading-relaxed border-l-4 border-blue-500 pl-6 text-lg animate-pulse">> ${prompt}</p>`;
                speakByVoice(prompt, 'Andrew');
            }, 1000);
        }

        function speakText(container) {
            // Provide a brief visual flash to indicate click registration
            const originalBg = container.style.backgroundColor;
            container.style.backgroundColor = '#e2e8f0';
            setTimeout(() => container.style.backgroundColor = originalBg, 200);

            const text = container.innerText.replace(/ðŸ”Š CLICK TO LISTEN \(85% SPEED\)/g, '');
            const voice = text.includes('Environmental') || text.includes('Habit') ? 'Emma' : 'Andrew';
            speakByVoice(text, voice);
        }

        function speakByVoice(text, voiceName) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                
                // MANDATORY 85% SPEED
                utterance.rate = 0.85; 
                
                const voices = window.speechSynthesis.getVoices();
                const target = voices.find(v => {
                    if (voiceName === 'Andrew') return v.name.includes('David') || v.name.includes('Male') || v.name.includes('Andrew');
                    if (voiceName === 'Emma') return v.name.includes('Zira') || v.name.includes('Female') || v.name.includes('Emma');
                    return false;
                });
                
                if (target) utterance.voice = target;
                window.speechSynthesis.speak(utterance);
            }
        }

        window.onclick = e => { if (e.target.id === 'detailModal') closeModal(); };
        window.onload = () => {
            renderTree();
            window.speechSynthesis.getVoices(); // Pre-load voices
        };
    </script>
</body>
</html>
